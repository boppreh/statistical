<html>
    <head>
        <meta charset="utf-8">
        <title>Statistical</title>
        <style>
body {
    background-color: #EEE;
    border-radius: 10px;
    padding: 14px 30px;

    font: 16px/150% Georgia, Times, 'Times New Roman', serif;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
    color: #444;
}

label {
    text-align: right;
    display: inline-block;
    width: 14em;
    padding-right: 0.5em;
}

input {
    width: auto;
}

.result {

}

#sample-data {
    display: inline-block;
}

#update-button {
    width: 100%;
}
        </style>
    </head>

    <body>
        <div id="sample-data">
            <label>Nível de confiança (%):</label><input id="confidence" value="95"><br>
            <label>Precisão (casas):</label><input id="precision" type="number" value="4"><br>
            <br>
            <label>Média:</label><input id="mean" value="0"><br>
            <label>Desvio padrão:</label><input id="stdev" value="1"><br>
            <label>Tamanho da amostra (n):</label><input id="n" type="number" value="20"><br>
            <label><input type="checkbox" id="population-n-known" onchange="document.getElementById('population-n').disabled = !this.checked;">Tamanho da população (N):</label><input id="population-n" type="number" value="1000" disabled><br>

            <button id="update-button" onclick="update();">Atualizar</button>
        </div>

        <div class="result">
            <h2>Intervalo de Confiança</h2>

            <span id="interval-mean">0</span> ± <span id="interval-width">1</span>
            <p>
            Entre <span id="interval-min">0</span> e <span id="interval-max">1</span>
        </div>

        <div class="result">
            <h2>Poder do Teste</h2>

            <label>Média em H0:</label><input id="mean-h0" type="number" value="20" onchange="updatePower()"><br>
            Poder do teste unilateral: <span id="power"></span>%
        </div>

        <script>
function get(variableName) {
    return Number(document.getElementById(variableName).value);
}

function set(elementId, value) {
    document.getElementById(elementId).innerHTML = value.toFixed(precision);
}

var confidence,
    precision,
    mean,
    stdev,
    n,
    populationN;

function update() {
    confidence = get("confidence") / 100;
    precision = get("precision");
    mean = get("mean");
    stdev = get("stdev");
    n = get("n");
    if (document.getElementById("population-n").disabled) {
        populationN = Number.POSITIVE_INFINITY;
    } else {
        populationN = get("population-n");
    }    

    updateConfidenceInterval();
    updatePower();
}

function updateConfidenceInterval() {
    set("interval-mean", mean);

    var sx = stdev / Math.sqrt(n);
    var t = aStudentT(1 - confidence, n - 1);
    var width = t * sx;
    if (n > 0.05 * populationN) {
        width *= Math.sqrt((populationN - n) / (populationN - 1));
    }

    set("interval-width",  width);
    set("interval-min",  mean - width);
    set("interval-max",  mean + width);
}

function updatePower() {
    var meanH0 = get("mean-h0");

    var tc = aStudentT(2 * (1 - confidence), n - 1);
    if (meanH0 > mean) {
        tc = -tc;
    }
    var xCritical = meanH0 + tc * stdev / Math.sqrt(n);
    var tbeta = (xCritical - mean) * Math.sqrt(n) / stdev;
    var beta = studentT(tbeta, n - 1) / 2;
    var power;
    // Fix for Student-T being two-tailed.
    if (tbeta > 0) {
        power = beta;
    } else {
        power = 1 - beta;
    }

    set("power", power * 100);
}

window.onload = update;
        </script>

        <script>
// Adapted from http://statpages.org/pdfs.html

var pi = Math.PI,
    piD2 = pi / 2;

function chiSq(x, n) {
    if (x > 1000 | n > 1000) {
        var q = Norm((Math.pow(x / n, 1 / 3) + 2 / (9 * n) - 1) / Math.sqrt(2 / (9 * n))) / 2;
        if (x > n) {
            return q;
        } else {
            return 1 - q;
        }
    }
    var p = Math.exp(-0.5 * x);
    if ((n % 2) == 1) {
        p = p * Math.sqrt(2 * x / pi);
    }
    var k = n;
    while (k >= 2) {
        p = p * x / k;
        k = k - 2;
    }
    var t = p;
    var a = n;
    while (t > 1e-15 * p) {
        a = a + 2;
        t = t * x / a;
        p = p + t;
    }
    return 1 - p;
}

function normal(z) {
    var q = z * z
    if (Math.abs(z) > 7) {
        return (1 - 1 / q + 3 / (q * q)) * Math.exp(-q / 2) / (Math.abs(z) * Math.sqrt(piD2));
    } {
        return chiSq(q, 1);
    }
}

// Two tailed Student T test for n degrees of freedom.
function studentT(t, n) {
    t = Math.abs(t);
    var w = t / Math.sqrt(n);
    var th = Math.atan(w);
    if (n == 1) {
        return 1 - th / piD2;
    }
    var sth = Math.sin(th);
    var cth = Math.cos(th)
    if ((n % 2) == 1) {
        return 1 - (th + sth * cth * statCom(cth * cth, 2, n - 3, -1)) / piD2;
    } else {
        return 1 - sth * statCom(cth * cth, 1, n - 3, -1);
    }
}

// Calculates t such that studentT(t, n) == p.
function aStudentT(p, n) {
    var v = 0.5;
    var dv = 0.5;
    var t = 0;
    while (dv > 1e-6) {
        t = 1 / v - 1;
        dv = dv / 2;
        if (studentT(t, n) > p) {
            v = v - dv;
        } else {
            v = v + dv;
        }
    }
    return t;
}

// Calculates z such that normal(z) == p.
function aNormal(p) {
    var v = 0.5;
    var dv = 0.5;
    var t = 0;
    while (dv > 1e-6) {
        t = 1 / v - 1;
        dv = dv / 2;
        if (normal(t, n) > p) {
            v = v - dv;
        } else {
            v = v + dv;
        }
    }
    return t;
}

function statCom(q, i, j, b) {
    var zz = 1;
    var z = zz;
    var k = i;
    while (k <= j) {
        zz = zz * q * k / (k - b);
        z = z + zz;
        k = k + 2;
    }
    return z;
}
        </script>
    </body>
</html>