<html>
    <head>
        <meta charset="utf-8">
        <title>Statistical</title>
        <style>
body {
    background-color: #EEE;
    border-radius: 10px;
    padding: 14px 30px;

    font: 16px/150% Georgia, Times, 'Times New Roman', serif;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
    color: #444;
}

h2 {
    margin-top: 2em;
    text-align: center;
}

label {
    text-align: right;
    display: inline-block;
    width: 15em;
    padding-right: 0.5em;
}

#sample-data input {
    width: auto;
}

.result input {
    width: 6em;
}

body > .result {
    vertical-align: top;
}

.result {
    display: inline-block;
    margin: 2em;
}

#sample-data {
    display: inline-block;
}

#update-button {
    width: 100%;
}
        </style>
    </head>

    <body>
        <div id="sample-data">
            <label>Nível de significância (%):</label><input id="confidence" value="95" type="number" step="any" min="0" max="100" onchange="update()"><br>
            <label>Precisão (casas):</label><input id="precision" type="number" value="4" min="0" onchange="update()"><br>
            <br>
            <label>Média observada:</label><input id="mean" value="0" type="number" step="any" onchange="update()"><br>
            <label><input type="radio" name="stdev-known" onchange="updateFormFields()" value="sample" checked>Desvio padrão amostral:</label><input id="stdev" value="1" type="number" step="any" onchange="update()"><br>
            <label><input type="radio" name="stdev-known" onchange="updateFormFields()" value="population">Desvio padrão populacional:</label><input id="population-stdev" value="1" type="number" step="any" onchange="update()"><br>
            <br>
            <label>Tamanho da amostra (n):</label><input id="n" type="number" value="20" min="0" onchange="update()"><br>
            <label><input type="checkbox" id="population-n-known" onchange="updateFormFields()">Tamanho da população (N):</label><input id="population-n" type="number" min="0" value="1000" onchange="update()"><br>
        </div>
        <br>

        <div class="result">
            <h2>Intervalo de Confiança</h2>

            <span id="interval-mean">0</span> ± <span id="interval-width">1</span>
            <p>
            Entre <span id="interval-min">0</span> e <span id="interval-max">1</span>
        </div>

        <div class="result">
            <h2>Teste de Uma Média</h2>

            <label>Média esperada:</label><input id="expected-mean" type="number" value="0.1" step="any" onchange="updateSingleMeanTest()">
            <br>
            Valor-p: <span id="expected-mean-p"></span>%<br>
            Resultado: <span id="expected-mean-result"></span>.
        </div>

        <div class="result">
            <h2>Poder do Teste</h2>

            <label>Média em H0:</label><input id="mean-h0" type="number" value="0.1" step="any" onchange="updatePower()"><br>
            X crítico: <span id="x-critical"></span><br>
            Poder do teste (unilateral): <span id="power"></span>%<br>
            <br>
            <label>Poder do teste desejado (%):</label><input id="target-power" type="number" step="any" min="0" max="100" value="90" onchange="updatePower()">
            <br>
            Amostras necessárias (teste unilateral): <span id="required-sample-uni"></span>
            <br>
            Amostras necessárias (teste bilateral): <span id="required-sample-bi"></span>
        </div>

        <script>
function get(variableName) {
    return Number(document.getElementById(variableName).value);
}

function set(elementId, value) {
    if (typeof value == "number") {
        value = value.toFixed(precision);
    }
    document.getElementById(elementId).innerHTML = value;
}

function updateFormFields() {
    var populationKnown = document.getElementsByName("stdev-known")[1].checked;
    document.getElementById("stdev").disabled = populationKnown;
    document.getElementById("population-stdev").disabled = !populationKnown;

    document.getElementById("population-n").disabled = !document.getElementById("population-n-known").checked;

    update();
}

var confidence,
    precision,
    mean,
    stdev,
    distribution,
    n,
    populationN;

function update() {
    confidence = get("confidence") / 100;
    precision = get("precision");
    mean = get("mean");
    n = get("n");
    if (document.getElementById("population-n").disabled) {
        populationN = Number.POSITIVE_INFINITY;
    } else {
        populationN = get("population-n");
    }
    if (document.getElementsByName("stdev-known")[1].checked) {
        distribution = normal;
        stdev = get("population-stdev");
    } else {
        distribution = studentT;
        stdev = get("stdev");
    }

    updateConfidenceInterval();
    updateSingleMeanTest();
    updatePower();
}

function updateSingleMeanTest() {
    var expectedMean = get("expected-mean");

    var t = Math.abs(mean - expectedMean) * Math.sqrt(n) / stdev;
    var pValue = distribution(t, n);
    var displayPValue = (pValue * 100).toFixed(precision);
    var displayAlpha = ((1 - confidence) * 100).toFixed(precision);
    set("expected-mean-p", displayPValue);

    if (pValue < 1 - confidence) {
        set("expected-mean-result", displayPValue + "% &lt; " + displayAlpha + "% portanto <strong>rejeita-se H0</strong>");
    } else {
        set("expected-mean-result", displayPValue + "% &gt; " + displayAlpha + "% portanto <strong>aceita-se H0</strong>");
    }
}

function updateConfidenceInterval() {
    set("interval-mean", mean);

    var sx = stdev / Math.sqrt(n);
    var t = a(distribution, (1 - confidence) / 2, n - 1);

    var width = t * sx;
    if (n > 0.05 * populationN) {
        width *= Math.sqrt((populationN - n) / (populationN - 1));
    }

    set("interval-width",  width);
    set("interval-min",  mean - width);
    set("interval-max",  mean + width);
}

function updatePower() {
    var meanH0 = get("mean-h0");

    var tc = a(distribution, 1 - confidence, n - 1);
    if (meanH0 > mean) {
        tc = -tc;
    }

    var xCritical = meanH0 + tc * stdev / Math.sqrt(n);
    set("x-critical", xCritical);

    var tbeta = (xCritical - mean) * Math.sqrt(n) / stdev;
    if (meanH0 < mean) {
        tbeta = -tbeta;
    }
    var beta = distribution(tbeta, n - 1);
    var power = 1 - beta;

    set("power", power * 100);

    var targetPower = get("target-power") / 100;
    var numUni = a(distribution, 1 - confidence, n - 1) + a(distribution, 1 - targetPower, n - 1);
    var numBi = a(distribution, (1 - confidence) / 2, n - 1) + a(distribution, 1 - targetPower, n - 1);
    var dem = Math.abs(mean - meanH0) / stdev;
    set("required-sample-uni", Math.pow(numUni / dem, 2));
    set("required-sample-bi", Math.pow(numBi / dem, 2));
}

window.onload = updateFormFields;
        </script>

        <script>
// Adapted from http://statpages.org/pdfs.html

var pi = Math.PI,
    piD2 = pi / 2;

function chiSq(x, n) {
    if (x > 1000 | n > 1000) {
        var q = Norm((Math.pow(x / n, 1 / 3) + 2 / (9 * n) - 1) / Math.sqrt(2 / (9 * n))) / 2;
        if (x > n) {
            return q;
        } else {
            return 1 - q;
        }
    }
    var p = Math.exp(-0.5 * x);
    if ((n % 2) == 1) {
        p = p * Math.sqrt(2 * x / pi);
    }
    var k = n;
    while (k >= 2) {
        p = p * x / k;
        k = k - 2;
    }
    var t = p;
    var a = n;
    while (t > 1e-15 * p) {
        a = a + 2;
        t = t * x / a;
        p = p + t;
    }
    return 1 - p;
}

// Single tailed normal.
function normal(z) {
    if (z > 0) {
        return dNormal(z) / 2;
    } else {
        return 1 - dNormal(z) / 2;
    }    
}

function studentT(t, n) {
    if (t > 0) {
        return dStudentT(t, n) / 2;
    } else {
        return 1 - dStudentT(t, n) / 2;
    }
}

// Two tailed Normal.
function dNormal(z) {
    var q = z * z
    if (Math.abs(z) > 7) {
        return (1 - 1 / q + 3 / (q * q)) * Math.exp(-q / 2) / (Math.abs(z) * Math.sqrt(piD2));
    } else {
        return chiSq(q, 1);
    }
}

// Two tailed Student T test for n degrees of freedom.
function dStudentT(t, n) {
    t = Math.abs(t);
    var w = t / Math.sqrt(n);
    var th = Math.atan(w);
    if (n == 1) {
        return 1 - th / piD2;
    }
    var sth = Math.sin(th);
    var cth = Math.cos(th)
    if ((n % 2) == 1) {
        return 1 - (th + sth * cth * statCom(cth * cth, 2, n - 3, -1)) / piD2;
    } else {
        return 1 - sth * statCom(cth * cth, 1, n - 3, -1);
    }
}

// Calculates t such that distribution(t, n) == p.
function a(distribution, p, n) {
    var mult = p > 0.5 ? -1 : 1;
    var v = 0.5;
    var dv = 0.5;
    var t = 0;
    while (dv > 1e-6) {
        t = 1 / v - 1;
        dv = dv / 2;
        if (distribution(mult * t, n) > p) {
            v = v - dv;
        } else {
            v = v + dv;
        }
    }
    return mult * t;
}

function statCom(q, i, j, b) {
    var zz = 1;
    var z = zz;
    var k = i;
    while (k <= j) {
        zz = zz * q * k / (k - b);
        z = z + zz;
        k = k + 2;
    }
    return z;
}
        </script>
    </body>
</html>