<html>
    <head>
        <meta charset="utf-8">
        <title>Statistical</title>
        <style>
body {
    background-color: #EEE;
    border-radius: 10px;
    padding: 14px 30px;

    font: 16px/150% Georgia, Times, 'Times New Roman', serif;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
    color: #444;
}

h2 {
    margin-top: 2em;
    text-align: center;
}

label {
    text-align: right;
    display: inline-block;
    width: 15em;
    padding-right: 0.5em;
}

#sample-data input {
    width: auto;
}

.result input {
    width: 6em;
}

body > .result {
    vertical-align: top;
}

.result {
    display: inline-block;
    margin: 1em;
    width: 24em;
}

#sample-data {
    display: inline-block;
}

#load-button {
    width: 100%;
}
        </style>
    </head>

    <body>
        <div id="sample-data">
            <label title="Número de casas decimais a serem exibidas. Afeta apenas a visualização e não altera os resultados computados.">Precisão (casas decimais):</label><input id="precision" type="number" value="4" min="0" onchange="update()"><br>
            <label title="Nível de significância desejado, 1 - alpha.">Nível de significância (%):</label><input id="confidence" value="95" type="number" step="any" min="0" max="100" onchange="update()"><br>
            <label title="Indica se você quer realizar testes de médias em apenas uma direção (maior que ou menor que a média observada)."><input type="checkbox" id="unilateral" onchange="update()">Usar testes unilaterais</label><br>
            <label title="Se o desvio padrão fornecido é o desvio padrão real da população."><input type="checkbox" id="population-stdev-known" onchange="update()">Desvio padrão é populacional</label><br>
            <label title="Tamanho total da população, se conhecido."><input type="checkbox" id="population-n-known" onchange="updateFormFields()">Tamanho da população (N):</label><input id="population-n" type="number" min="0" value="1000" onchange="update()"><br>
            <br>
            <label title="Média observada dos dados amostrados.">Média:</label><input id="mean" value="174" type="number" step="any" onchange="update()"><br>
            <label title="Desvio padrão dos dados amostrados (ou da população se indicado acima).">Desvio padrão:</label><input id="stdev" value="15" type="number" step="any" onchange="update()"><br>
            <label title="Número de elementos na amostra.">Tamanho da amostra:</label><input id="n" type="number" value="20" min="0" onchange="update()"><br>
            <button id="load-button" onclick="loadData()">Carregar dados</button><br>
        </div>
        <br>

        <div class="result">
            <h2>Intervalo de Confiança</h2>

            <span id="interval-mean">0</span> ± <span id="interval-width">1</span>
            <p>
            Entre <span id="interval-min">0</span> e <span id="interval-max">1</span>
        </div>

        <div class="result">
            <h2>Teste de Uma Média</h2>

            <label title="Média esperada caso a amostra fosse aleatória.">Média esperada:</label><input id="expected-mean" type="number" value="170" step="any" onchange="updateSingleMeanTest()"><br>
            <br>
            Valor-p: <span id="expected-mean-p"></span>%<br>
            Resultado: <span id="expected-mean-result"></span>
        </div>

        <div class="result">
            <h2>Poder do Teste</h2>

            <label title="Média esperada caso a amostra fosse aleatória.">Média em H<sub>0</sub>:</label><input id="mean-h0" type="number" value="170" step="any" onchange="updatePower()"><br>
            X crítico: <span id="x-critical"></span><br>
            Poder do teste: <span id="power"></span>%<br>
            <br>
            <label title="Probabilidade desejada de rejeitar uma hipótese nula falsa.">Poder do teste desejado (%):</label><input id="target-power" type="number" step="any" min="0" max="100" value="90" onchange="updatePower()">
            <br>
            Amostras necessárias: <span id="required-sample"></span>
        </div>

        <div class="result">
            <h2>Teste de Duas Médias</h2>

            Segundo grupo:<br>
            <label title="Média observada na amostra do segundo grupo.">Média:</label><input id="second-mean" type="number" value="171" step="any" onchange="updateComparison()"><br>
            <label title="Desvio padrão observado na amostra do segundo grupo.">Desvio padrão:</label><input id="second-stdev" type="number" value="12" step="any" onchange="updateComparison()"><br>
            <label title="Número de elementos na amostra do segundo grupo.">Tamanho da amostra:</label><input id="second-n" type="number" value="15" step="1" onchange="updateComparison()"><br>
            <p>

            Valor-p: <span id="comparison-p"></span>%<br>
            Resultado: <span id="comparison-result"></span><br>
            <a id="comparison-link" href="">Análise das diferenças</a>.
        </div>

        <script>
function format(value) {
    if (typeof value == "number") {
        return value.toFixed(precision).replace(/\.?0+$/, '');
    } else {
        return value;
    }
}

function get(variableName) {
    return Number(document.getElementById(variableName).value.replace(",", "."));
}

function set(elementId, value, includesStyle) {
    value = format(value);
    if (!includesStyle) {
        value = "<strong>" + value + "</strong>";
    }
    document.getElementById(elementId).innerHTML = value;
}

function loadData() {
    var allData = prompt("Cole os dados numéricos separados por espaço.");
    if (!allData) {
        return;
    }

    var strData = allData.replace(",", ".").split(/\s+/);
    var data = [];
    var n = strData.length;
    for (var i = 0; i < n; i++) {
        var value = Number(strData[i]);
        if (isNaN(value)) {
            alert("Erro ao ler o valor " + strData[i]);
            return;
        }
        data[i] = value;
    }

    var sum = 0;
    for (var i = 0; i < n; i++) {
        sum += data[i];
    }
    var mean = sum / n;
    var squaredDifs = 0;
    for (var i = 0; i < n; i++) {
        squaredDifs += Math.pow(data[i] - mean, 2);
    }

    
    var stdev = Math.sqrt(squaredDifs / (n - 1));
    document.getElementById("mean").value = mean;
    document.getElementById("stdev").value = stdev;
    document.getElementById("n").value = n;
    document.getElementsByName("population-stdev-known").checked = false;
    updateFormFields();
}

function updateFormFields() {
    document.getElementById("population-n").disabled = !document.getElementById("population-n-known").checked;

    update();
}

var confidence,
    precision,
    mean,
    stdev,
    distribution,
    n,
    populationN,
    sx,
    tails;

function update() {
    confidence = get("confidence") / 100;
    precision = get("precision");
    tails = document.getElementById("unilateral").checked ? 1 : 2;
    mean = get("mean");
    n = get("n");
    stdev = get("stdev");
    sx = stdev / Math.sqrt(n)

    if (document.getElementsByName("stdev-known").checked) {
        distribution = normal;
    } else {
        distribution = studentT;
    }

    if (document.getElementById("population-n").disabled) {
        populationN = Number.POSITIVE_INFINITY;
    } else {
        populationN = get("population-n");
        var populationNCorrection = Math.sqrt((populationN - n) / (populationN - 1));
        sx *= populationNCorrection;
    }    

    updateConfidenceInterval();
    updateSingleMeanTest();
    updatePower();
    updateComparison();
}


function updateConfidenceInterval() {
    set("interval-mean", mean);

    var t = a(distribution, (1 - confidence) / 2, n - 1);
    var width = t * sx;

    set("interval-width",  width);
    set("interval-min",  mean - width);
    set("interval-max",  mean + width);
}

function updateSingleMeanTest() {
    var expectedMean = get("expected-mean");

    var t = Math.abs(mean - expectedMean) / sx;
    var pValue = distribution(t, n - 1) * tails;
    var displayPValue = format(pValue * 100);
    var displayAlpha = format((1 - confidence) * 100);
    set("expected-mean-p", displayPValue);

    if (pValue < 1 - confidence) {
        set("expected-mean-result", displayPValue + "% &lt; " + displayAlpha + "% portanto <strong>rejeita-se H0</strong>. É diferente da média esperada.", true);
    } else {
        set("expected-mean-result", displayPValue + "% &gt; " + displayAlpha + "% portanto <strong>aceita-se H0</strong>. Não foi detectada diferença da média esperada.", true);
    }
}

function updatePower() {
    var meanH0 = get("mean-h0");

    var tc = a(distribution, 1 - confidence, n - 1);
    if (meanH0 > mean) {
        tc = -tc;
    }

    var xCritical = meanH0 + tc * sx;
    set("x-critical", xCritical);

    var tbeta = (xCritical - mean) * sx;
    if (meanH0 < mean) {
        tbeta = -tbeta;
    }
    var beta = distribution(tbeta, n - 1) * tails;
    var power = 1 - beta;

    set("power", power * 100);

    var targetPower = get("target-power") / 100;
    var num = a(distribution, (1 - confidence) / tails, n - 1) + a(distribution, 1 - targetPower, n - 1);
    var dem = Math.abs(mean - meanH0) / stdev;
    set("required-sample", Math.pow(num / dem, 2));
}

function updateComparison() {
    var mean2 = get("second-mean");
    var stdev2 = get("second-stdev");
    var n2 = get("second-n");

    var variance = ((n - 1) * stdev * stdev + (n2 - 1) * stdev2 * stdev2) / (n + n2 -2);
    var sizeFactor = Math.sqrt(1 / n + 1 / n2);
    var t = Math.abs(mean - mean2) / (Math.sqrt(variance) * sizeFactor);

    var pValue = distribution(t, n + n2 - 2) * tails;
    var displayPValue = format(pValue * 100);
    var displayAlpha = format((1 - confidence) * 100);
    set("comparison-p", displayPValue);

    if (pValue < 1 - confidence) {
        set("comparison-result", displayPValue + "% &lt; " + displayAlpha + "% portanto <strong>rejeita-se H0</strong>. Há diferença entre a média dos grupos.", true);
    } else {
        set("comparison-result", displayPValue + "% &gt; " + displayAlpha + "% portanto <strong>aceita-se H0</strong>. Não foi detectada diferença entre a média dos grupos.", true);
    }

    document.getElementById("comparison-link").href = "?mean=" + (mean - mean2) + "&stdev=" + Math.sqrt(variance) + "&n=" + (n + n2) + "&expected-mean=0&mean-h0=0";
}

window.onload = function () {
    var regex = new RegExp(/([\w-]+)=([-0-9.,]+)/g);
    while((match = regex.exec(location.search)) !== null){
        document.getElementById(match[1]).value = Number(match[2]);
    }

    updateFormFields();
};
        </script>

        <script>
// Adapted from http://statpages.org/pdfs.html

var pi = Math.PI,
    piD2 = pi / 2;

function chiSq(x, n) {
    if (x > 1000 | n > 1000) {
        var q = Norm((Math.pow(x / n, 1 / 3) + 2 / (9 * n) - 1) / Math.sqrt(2 / (9 * n))) / 2;
        if (x > n) {
            return q;
        } else {
            return 1 - q;
        }
    }
    var p = Math.exp(-0.5 * x);
    if ((n % 2) == 1) {
        p = p * Math.sqrt(2 * x / pi);
    }
    var k = n;
    while (k >= 2) {
        p = p * x / k;
        k = k - 2;
    }
    var t = p;
    var a = n;
    while (t > 1e-15 * p) {
        a = a + 2;
        t = t * x / a;
        p = p + t;
    }
    return 1 - p;
}

// Single tailed normal.
function normal(z) {
    if (z > 0) {
        return dNormal(z) / 2;
    } else {
        return 1 - dNormal(z) / 2;
    }    
}

function studentT(t, n) {
    if (t > 0) {
        return dStudentT(t, n) / 2;
    } else {
        return 1 - dStudentT(t, n) / 2;
    }
}

// Two tailed Normal.
function dNormal(z) {
    var q = z * z
    if (Math.abs(z) > 7) {
        return (1 - 1 / q + 3 / (q * q)) * Math.exp(-q / 2) / (Math.abs(z) * Math.sqrt(piD2));
    } else {
        return chiSq(q, 1);
    }
}

// Two tailed Student T test for n degrees of freedom.
function dStudentT(t, n) {
    t = Math.abs(t);
    var w = t / Math.sqrt(n);
    var th = Math.atan(w);
    if (n == 1) {
        return 1 - th / piD2;
    }
    var sth = Math.sin(th);
    var cth = Math.cos(th)
    if ((n % 2) == 1) {
        return 1 - (th + sth * cth * statCom(cth * cth, 2, n - 3, -1)) / piD2;
    } else {
        return 1 - sth * statCom(cth * cth, 1, n - 3, -1);
    }
}

// Calculates t such that distribution(t, n) == p.
function a(distribution, p, n) {
    var mult = p > 0.5 ? -1 : 1;
    var v = 0.5;
    var dv = 0.5;
    var t = 0;
    while (dv > 1e-6) {
        t = 1 / v - 1;
        dv = dv / 2;
        if (distribution(mult * t, n) > p) {
            v = v - dv;
        } else {
            v = v + dv;
        }
    }
    return mult * t;
}

function statCom(q, i, j, b) {
    var zz = 1;
    var z = zz;
    var k = i;
    while (k <= j) {
        zz = zz * q * k / (k - b);
        z = z + zz;
        k = k + 2;
    }
    return z;
}
        </script>
    </body>
</html>